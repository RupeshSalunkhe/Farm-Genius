<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Genius ðŸŒ± | Disease Prediction</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-container glassmorphism">
        <div class="nav-links">
            <h1 class="gradient-text">Farm Genius</h1>
            <div>
                <a href="index.html">Home</a>
                <a href="predict.html" class="active">Disease Predict</a>
                <a href="crop.html">Crop Info</a>
                <a href="contact.html">Contact</a>
                <a href="about.html">About</a>
            </div>
        </div>
    </nav>

    <!-- Main Prediction Section -->
    <main class="prediction-container">
        <section class="glassmorphism prediction-card">
            <h2 class="gradient-text">Plant Disease Detection</h2>
            <div class="upload-section">
                <div class="drop-zone" id="dropZone"
                    ondragover="handleDragOver(event)"
                    ondragleave="handleDragLeave(event)"
                    ondrop="handleDrop(event)">
                    <i class="fas fa-cloud-upload-alt fa-3x"></i>
                    <p>Drag and drop plant leaf image here</p>
                    <span>or</span>
                    <button class="gradient-btn" onclick="document.getElementById('fileInput').click()">
                        Browse Files
                    </button>
                    <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFileSelect(event)">
                </div>
                <div class="file-requirements">
                    <p>Supported formats: JPG, PNG, JPEG</p>
                    <p>Max file size: 5MB</p>
                </div>
            </div>

            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview">
                <img id="previewImage" alt="Uploaded plant image">
                <button class="close-btn" onclick="clearImage()">&times;</button>
            </div>

            <!-- Prediction Results -->
            <div class="results" id="results">
                <div class="loading-spinner" id="spinner">
                    <div class="spinner"></div>
                    <p>Analyzing plant health...</p>
                </div>
                <div class="prediction-result" id="predictionResult">
                    <h3>Diagnosis Result</h3>
                    <div class="result-card glassmorphism">
                        <p class="disease-name" id="diseaseName">Healthy Plant</p>
                        <div class="confidence-meter">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <p class="confidence-value" id="confidenceValue">Confidence: 98%</p>
                        <div class="recommendations" id="recommendations">
                            <h4>Recommended Actions:</h4>
                            <ul id="recommendationsList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Chatbot -->
    <div class="chatbot-container glassmorphism">
        <div class="chatbot-header" onclick="toggleChat()">
            <h3>Farm Assistant</h3>
            <i class="fas fa-robot"></i>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Ask about plant diseases...">
            <button class="send-btn" onclick="handleUserMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script src="scripts/script.js"></script>
    <script>
        // Image Handling
        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                processImage(files[0]);
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processImage(files[0]);
            }
            document.getElementById('dropZone').classList.remove('dragover');
        }

        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('dropZone').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            document.getElementById('dropZone').classList.remove('dragover');
        }

        function processImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('previewImage');
                preview.src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                startAnalysis(file);
            }
            reader.readAsDataURL(file);
        }

        function clearImage() {
            document.getElementById('previewImage').src = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('results').style.display = 'none';
        }

        // Prediction Simulation
        async function startAnalysis(file) {
            document.getElementById('spinner').style.display = 'flex';
            document.getElementById('predictionResult').style.display = 'none';

            // Simulate API call
            setTimeout(() => {
                document.getElementById('spinner').style.display = 'none';
                document.getElementById('predictionResult').style.display = 'block';
                document.getElementById('diseaseName').textContent = 'Powdery Mildew';
                document.getElementById('confidenceValue').textContent = 'Confidence: 92%';
                document.getElementById('confidenceFill').style.width = '92%';
                document.getElementById('recommendationsList').innerHTML = `
                    <li>Apply sulfur-based fungicides</li>
                    <li>Improve air circulation</li>
                    <li>Remove infected leaves</li>
                `;
            }, 2000);
        }
    </script>
</body>
</html>